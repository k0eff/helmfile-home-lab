image:
  repository: k0eff/nextcloud-full
  tag: full
  flavor: fpm
nextcloud:
  host: "{{ requiredEnv "NEXTCLOUD_HOST" }}"
  configs:
    preserveip.config.php: |-
      <?php
      $CONFIG = array (
        'trusted_proxies' => array(
          0 => '127.0.0.1',
          1 => '{{ requiredEnv "NEXTCLOUD_PRESERVEIP_CIDR" }}',
        ),
        'forwarded_for_headers' => array('HTTP_X_FORWARDED_FOR'),
      );
  username: "{{ requiredEnv "NEXTCLOUD_USER" }}"
  password: "{{ requiredEnv "NEXTCLOUD_PASS" }}"
ingress:
  className: nginx
  enabled: true
  annotations:
    "nginx.ingress.kubernetes.io/enable-cors": "true"
    "nginx.ingress.kubernetes.io/cors-allow-headers": "X-Forwarded-For"
    "nginx.ingress.kubernetes.io/proxy-body-size": "17179869184"
    "nginx.ingress.kubernetes.io/proxy-max-temp-file-size": "17179869184"
    "nginx.ingress.kubernetes.io/proxy_buffer_size": "16777216"
nginx:
  enabled: true
persistence:
  enabled: true
  storageClass: {{ .Environment.Name }}-storageclass-datastore1
  accessMode: ReadWriteOnce
internalDatabase:
  enabled: false
postgresql:
  enabled: true
  global:
    postgresql:
      auth:
        database: "{{ requiredEnv "NEXTCLOUD_POSTGRE_DB" }}"
        username: "{{ requiredEnv "NEXTCLOUD_POSTGRE_USER" }}"
        password: "{{ requiredEnv "NEXTCLOUD_POSTGRE_PASS" }}"
  primary:
    persistence:
      enabled: true
      accessMode: ReadWriteOnce
      size: 8Gi
      nextcloudData:
        enabled: true
        accessMode: ReadWriteOnce
        size: 100Gi
metrics:
  enabled: true
  token: "{{ requiredEnv "NEXTCLOUD_METRICS_TOKEN" }}"
